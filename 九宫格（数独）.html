<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>九宫格</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			font-size: 25px;
		}
		th{
			border: 1px solid #333;
			width: 50px;
			height: 50px;
			border-left: 0;
			border-top: 0;
		}
	</style>
</head>
<body>
<center>
	<table cellspacing="0">
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
	</table>
</center>
<script>
	function randomIntNum(min,max,num){//获取num个min~max之间的数字,min与max正负均可
		if(isNaN(min))
			min = 0;
		if(isNaN(max))
			max = 1;
		if(isNaN(num))
			num = 1;
		var result = [];
		var t = 0;
		while(t != num) {
			var p = Math.ceil(Math.random()*(max-min+1))+min-1;
			for (var i = 0; i < t; i++) {
				if(p == result[i])
					break;
			}
			if(i >= t){
				result.push(p);
				t++;
			}
		}
		return result;
	}
	function crosswise(locat,num){//判断横排是否存在相同值
		var t = Math.floor(locat/9)*9;
		for (var i = 0; i < 9; i++) {
			if(aTh[t+i].innerHTML == num && t+i != locat)
				return false;
		}
		return true;
	}
	function vertical(locat,num){//判断竖排是否存在相同值
		var t = locat % 9;
		for (var i = 0; i < 9; i++) {
			if(aTh[i*9+t].innerHTML == num && i*9+t != locat)
				return false;
		}
		return true;
	}
	function module(locat,num){//判断宫内是否存在相同值
		var t1 = Math.floor(Math.floor(locat/9)/3);
		var t2 = Math.floor(locat%9/3);
		for (var i = 0; i < 3; i++) {
			for(var j = 0; j<3; j++){
				if(aTh[t1*27+t2*3+i*9+j].innerHTML == num && t1*27+t2*3+i*9+j != locat)
					return false;
			}
		}
		return true;
	}
	function produce(n){
		if(n > 80)
			return true;
		var num = randomIntNum(1,9,9);
		for (var i = 0; i < 9; i++) {
			aTh[n].innerHTML = num[i];
			if(crosswise(n,num[i])&&vertical(n,num[i])&&module(n,num[i])){
				if(produce(n+1)){
					return true;
				}
			}
		}
		return false;
	}
	function mistake(){	
		for (var i = 0; i < aTh.length; i++) {
			aTh[i].style.color = "black";
			for(var j = Math.floor(i/9)*9; j < (Math.floor(i/9)+1)*9; j++){
				if(aTh[i].innerHTML == aTh[j].innerHTML && i!=j){
					aTh[i].style.color = "red";
					break;
				}
			}
			for(var j = 0; j < 9; j++){
				if(aTh[i].innerHTML == aTh[j*9+i%9].innerHTML && i!=j*9+i%9){
					aTh[i].style.color = "red";
					break;
				}
			}
			var t1 = Math.floor(Math.floor(i/9)/3);
			var t2 = Math.floor(i%9/3);
			for(var j = 0; j < 3; j++){
				for(var k = 0; k < 3; k++){
					if(aTh[i].innerHTML == aTh[t1*27+t2*3+j*9+k].innerHTML && i!=t1*27+t2*3+j*9+k){
						aTh[i].style.color = "red";
						break;
					}
				}

			}
		}
	}
	aTh = document.getElementsByTagName('th');
	for (var i = 0; i < aTh.length; i++) {//将网格分为9大块（黑线）
		if((i+1) % 3 == 0)
			aTh[i].style.borderRight = "4px solid black";
		if(((i/9)+1) % 3 < 1)
			aTh[i].style.borderBottom = "4px solid black";
		if(i < 9)
			aTh[i].style.borderTop = "4px solid black";
		if(i%9 == 0)
			aTh[i].style.borderLeft = "4px solid black";
	}
	while(!produce(0)){//生成一个九宫格
		for (var i = 0; i < aTh.length; i++) {
			aTh[i].innerHTML = "";
		}
	}
	var locat = randomIntNum(0,80,60);
	for (var i = 0; i < locat.length; i++) {
		aTh[locat[i]].style.backgroundColor = "#D3D3D3";
		aTh[locat[i]].index = aTh[i].innerHTML;	
	}
	for (var i = 0; i < aTh.length; i++) {
		if(!aTh[i].index){
			aTh[i].innerHTML = "";
			aTh[i].onclick = function(){
				
				if(this.innerHTML=='' || this.innerHTML=='9')
					this.innerHTML = 1;
				else
					this.innerHTML++;
				mistake();
			}
		}
	}
	
</script>
</body>
</html>