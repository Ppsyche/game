<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>九宫格</title>
	<style>
		*{
			margin: 0;
			padding: 0;	
		}
		table{
			font-size: 25px;
			display: inline-block;
		}
		th{
			border: 1px solid #333;
			width: 50px;
			height: 50px;
			border-left: 0;
			border-top: 0;
		}
		#btn-box{
			display: inline-block;
		}
		#btn-box .btn{
			/*border: 1px solid black;*/
			color: #fff;
			width: 143px;
			height: 40px;
			line-height: 40px;
			display: block;
			/*padding: 5px 30px;*/
			margin-top: 15px;
			cursor: pointer;
			background:#b1b1b1 url(img/bg10.jpg) no-repeat left top;
		}
		#btn-box .btn:hover{
			background:#b1b1b1 url(img/bg10.jpg) no-repeat left -40px;
		}
	</style>
</head>
<body>
<center>
	<div id="btn-box">
		<span class="btn">初级</span>
		<span class="btn">中级</span>
		<span class="btn">高级</span>
	</div>
	<table cellspacing="0">
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
	</table>
</center>
<script>
	function randomIntNum(min,max,num){//获取num个min~max之间的数字,min与max正负均可
		if(isNaN(min))
			min = 0;
		if(isNaN(max))
			max = 1;
		if(isNaN(num))
			num = 1;
		var result = [];
		var t = 0;
		while(t != num) {
			var p = Math.ceil(Math.random()*(max-min+1))+min-1;
			for (var i = 0; i < t; i++) {
				if(p == result[i])
					break;
			}
			if(i >= t){
				result.push(p);
				t++;
			}
		}
		return result;
	}
	function crosswise(locat,num){//判断横排是否存在相同值
		var t = Math.floor(locat/9)*9;
		for (var i = 0; i < 9; i++) {
			if(aTh[t+i].innerHTML == num && t+i != locat)
				return false;
		}
		return true;
	}
	function vertical(locat,num){//判断竖排是否存在相同值
		var t = locat % 9;
		for (var i = 0; i < 9; i++) {
			if(aTh[i*9+t].innerHTML == num && i*9+t != locat)
				return false;
		}
		return true;
	}
	function module(locat,num){//判断宫内是否存在相同值
		var t1 = Math.floor(Math.floor(locat/9)/3);
		var t2 = Math.floor(locat%9/3);
		for (var i = 0; i < 3; i++) {
			for(var j = 0; j<3; j++){
				if(aTh[t1*27+t2*3+i*9+j].innerHTML == num && t1*27+t2*3+i*9+j != locat)
					return false;
			}
		}
		return true;
	}
	function produce(n){//产生一个合法的数字
		if(n > 80)
			return true;
		var num = randomIntNum(1,9,9);
		for (var i = 0; i < 9; i++) {
			aTh[n].innerHTML = num[i];
			if(crosswise(n,num[i])&&vertical(n,num[i])&&module(n,num[i])){
				if(produce(n+1)){
					return true;
				}
			}
		}
		return false;
	}
	function mistake(){	//判断纵横宫内是否有相同的数字
		for (var i = 0; i < aTh.length; i++) {
			aTh[i].style.color = "black";
			for(var j = Math.floor(i/9)*9; j < (Math.floor(i/9)+1)*9; j++){
				if(aTh[i].innerHTML == aTh[j].innerHTML && i!=j){
					aTh[i].style.color = "red";
					break;
				}
			}
			for(var j = 0; j < 9; j++){
				if(aTh[i].innerHTML == aTh[j*9+i%9].innerHTML && i!=j*9+i%9){
					aTh[i].style.color = "red";
					break;
				}
			}
			var t1 = Math.floor(Math.floor(i/9)/3);
			var t2 = Math.floor(i%9/3);
			for(var j = 0; j < 3; j++){
				for(var k = 0; k < 3; k++){
					if(aTh[i].innerHTML == aTh[t1*27+t2*3+j*9+k].innerHTML && i!=t1*27+t2*3+j*9+k){
						aTh[i].style.color = "red";
						break;
					}
				}

			}
		}
	}
	function getClass(clsName,context){//在context下获取class为clsName的元素数组
		var result = [];
		context = context || document;
		var arr = context.getElementsByTagName('*');
		for(var i=0; i<arr.length; i++){
			//class  保留字 .className
			//'aa bb' == 'aa'   'aacc'
			if(arr[i].className.indexOf(clsName) != -1){
				result.push(arr[i]);
			}
		}
		return result;
	}
	function clear(){//清除表格内的内容
		for (var i = 0; i < aTh.length; i++) {
			aTh[i].innerHTML = "";
			aTh[i].style.backgroundColor = "#fff";
			aTh[i].index = 0;
			aTh[i].style.color = "black";
			aTh[i].onclick = function(){}
		}
	}
	function Refresh(locat){	
		while(!produce(0)){//生成一个合法的九宫格
			for (var i = 0; i < aTh.length; i++) {
				aTh[i].innerHTML = "";
			}
		}
		for (var i = 0; i < locat.length; i++) {//将被选中位置的背景改为灰色并改变index值
			aTh[locat[i]].style.backgroundColor = "#D3D3D3";
			aTh[locat[i]].index = aTh[i].innerHTML;	
		}
		for (var i = 0; i < aTh.length; i++) {//给未被选中的位置绑点击事件
			if(!aTh[i].index){
				aTh[i].innerHTML = "";
				aTh[i].onclick = function(){	
					if(this.innerHTML=='' || this.innerHTML=='9')
						this.innerHTML = 1;
					else
						this.innerHTML++;
					mistake();
				}
			}
		}
	}
	aTh = document.getElementsByTagName('th');
	var oBtnBox = document.getElementById('btn-box')[0],
	aBtn = getClass('btn',oBtnBox);
	for (var i = 0; i < aTh.length; i++) {//将网格分为9大块（黑线）
		if((i+1) % 3 == 0)
			aTh[i].style.borderRight = "4px solid black";
		if(((i/9)+1) % 3 < 1)
			aTh[i].style.borderBottom = "4px solid black";
		if(i < 9)
			aTh[i].style.borderTop = "4px solid black";
		if(i%9 == 0)
			aTh[i].style.borderLeft = "4px solid black";
	}
	var locat = randomIntNum(0,80,50);
	Refresh(locat);
	for (var j = 0; j < aBtn.length; j++) {
		aBtn[j].index = j;
		aBtn[j].onclick = function(){
			switch(this.index){
				case 0:locat = randomIntNum(0,80,50);break;
				case 1:locat = randomIntNum(0,80,35);break;
				case 2:locat = randomIntNum(0,80,20);break;
			}
			clear();
			Refresh(locat);
		}
	}
	
</script>
</body>
</html>